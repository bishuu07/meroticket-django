{% extends "ticket/base_user.html" %}

{% block title %}Tickets Purchased{% endblock %}

{% block content %}

<div class="container mt-5">
    <div class="card shadow p-4">

        <h2 class="text-success">ðŸŽ‰ Payment Successful!</h2>
        <p>You purchased {{ tickets|length }} tickets.</p>

        <hr>

        {% for ticket in tickets %}
        <div class="mb-4">
            <h5><strong>Ticket {{ forloop.counter }}</strong></h5>

            <p><strong>Ticket ID:</strong> {{ ticket.id }}</p>
            <p><strong>Event:</strong> {{ ticket.ticket_type.event.name }}</p>
            <p><strong>Ticket Type:</strong> {{ ticket.ticket_type.name }}</p>
            <p><strong>Price:</strong> Rs. {{ ticket.ticket_type.price }}</p>

            <img src="{{ ticket.qr_image.url }}" width="180"
                 class="img-fluid border p-2">

            <br><br>

            <a href="{% url 'download_ticket_png' ticket.id %}"
               class="btn btn-primary btn-sm">
                â¬‡ Download Ticket PNG
            </a>

            <hr>

            <!-- Auto PDF download link -->
            <a id="autoDownload{{ ticket.id }}"
               href="{% url 'download_ticket_png' ticket.id %}"
               style="display:none;">
            </a>
        </div>
        {% endfor %}

    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const links = document.querySelectorAll("[id^='autoDownload']");
    let delay = 600;

    links.forEach(link => {
        setTimeout(() => { link.click(); }, delay);
        delay += 800; // avoid browser blocking multiple simultaneous downloads
    });
});
</script>

{% endblock %}
